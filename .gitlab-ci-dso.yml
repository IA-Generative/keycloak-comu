include:
- project: $CATALOG_PATH
  file: vault-ci.yml
  ref: main
- project: $CATALOG_PATH
  file: kaniko-ci.yml
  ref: main

default:
  image: alpine:latest

stages:
- read-secret
- docker-build

read_secret:
  stage: read-secret
  extends:
  - .vault:read_secret

build:
  variables:
    WORKING_DIR: ./
    DOCKERFILE: ./Dockerfile
    IMAGE_NAMES: app:${CI_COMMIT_SHORT_SHA} app:${CI_COMMIT_REF_NAME}
  stage: docker-build
  extends:
  - .kaniko:build-push
  # Triggers job only if a file in the client directory changed in current commit
  # rules:
  #   - changes:
  #     - client/**/*
